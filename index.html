<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Elvebyen FK – Tabell og kamper</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#0b0f14;color:#e6edf3}
    header{padding:24px;text-align:center}
    header h1{margin:0 0 6px}
    main{max-width:1100px;margin:0 auto;padding:24px;display:grid;gap:16px}
    @media(min-width:900px){main{grid-template-columns:1.2fr .8fr}}
    .card{background:#10161e;border:1px solid #1b2430;border-radius:14px;overflow:hidden}
    .card header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0f1420;border-bottom:1px solid #1b2430}
    .card .content{padding:12px 16px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid #1b2430;text-align:left;font-variant-numeric:tabular-nums}
    th{position:sticky;top:0;background:#0f1420}
    .right{text-align:right}
    .ok{color:#8ae38a}.bad{color:#ff8a8a}
    .list{display:flex;flex-direction:column;gap:10px}
    .match{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;padding:10px 12px;border:1px solid #1b2430;border-radius:12px}
    .meta{grid-column:1/-1;opacity:.75;font-size:12px}
    .muted{opacity:.7}
    button{background:#1f6feb;color:#fff;border:0;border-radius:10px;padding:8px 12px;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <h1>Elvebyen FK</h1>
    <p class="muted">Henter fra <code>data/elvebyen.json</code></p>
  </header>

  <main>
    <section class="card">
      <header>
        <h2>Tabell</h2>
        <button id="reloadBtn" type="button">Oppdater</button>
      </header>
      <div class="content" id="tabellWrap">Laster…</div>
    </section>

    <section class="card">
      <header><h2>Kommende kamper</h2></header>
      <div class="content" id="kamperWrap">Laster…</div>
    </section>
  </main>

  <script>
    const JSON_URL = 'data/elvebyen.json';
    const tabellWrap = document.getElementById('tabellWrap');
    const kamperWrap = document.getElementById('kamperWrap');
    document.getElementById('reloadBtn').addEventListener('click', loadData);

    async function loadData(){
      try{
        const res = await fetch(JSON_URL, {cache:'no-store'});
        if(!res.ok) throw new Error('Kunne ikke laste '+JSON_URL);
        const data = await res.json();
        renderTable(data.table || []);
        renderMatches((data.matches && data.matches.upcoming) ? data.matches.upcoming : []);
      }catch(e){
        tabellWrap.textContent = e.message;
        kamperWrap.textContent = e.message;
      }
    }

    function renderTable(rows){
      if(!rows.length){ tabellWrap.innerHTML = '<p class="muted">Ingen tabell-data ennå.</p>'; return; }
      const thead = `
        <thead><tr>
          <th>#</th><th>Lag</th>
          <th class="right">S</th><th class="right">V</th><th class="right">U</th><th class="right">T</th>
          <th class="right">Mål</th><th class="right">+/-</th><th class="right">Poeng</th>
        </tr></thead>`;
      const tbody = rows.map((r,i)=>{
        const cls = r.gd>0?'ok':(r.gd<0?'bad':'');
        return `<tr>
          <td>${i+1}</td><td>${r.team}</td>
          <td class="right">${r.p??''}</td><td class="right">${r.v??''}</td><td class="right">${r.u??''}</td><td class="right">${r.t??''}</td>
          <td class="right">${(r.gm??0)}–${(r.ga??0)}</td>
          <td class="right ${cls}">${r.gd??''}</td>
          <td class="right"><strong>${r.pts??''}</strong></td>
        </tr>`;
      }).join('');
      tabellWrap.innerHTML = `<div style="max-height:520px;overflow:auto"><table>${thead}<tbody>${tbody}</tbody></table></div>`;
    }

    function renderMatches(list){
      if(!list.length){ kamperWrap.innerHTML = '<p class="muted">Ingen kommende kamper.</p>'; return; }
      kamperWrap.innerHTML = '<div class="list">'+list.slice(0,10).map(m=>{
        const dt = m.kickoff ? new Date(m.kickoff) : null;
        const d = dt ? dt.toLocaleDateString('no-NO', {day:'2-digit',month:'2-digit',year:'numeric'}) : (m.dateText||'');
        const t = dt ? dt.toLocaleTimeString('no-NO', {hour:'2-digit',minute:'2-digit'}) : (m.timeText||'');
        const score = (m.homeGoals!=null && m.awayGoals!=null) ? `${m.homeGoals}–${m.awayGoals}` : 'vs';
        return `<div class="match">
          <div class="meta">${d} ${t} • ${m.venue||''}</div>
          <div style="text-align:right">${m.home}</div>
          <div>${score}</div>
          <div>${m.away}</div>
        </div>`;
      }).join('')+'</div>';
    }

    loadData();
  </script>
</body>
</html>
